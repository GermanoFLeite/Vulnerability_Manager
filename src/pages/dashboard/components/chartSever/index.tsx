import { Flex } from "@chakra-ui/react";
import axios from "axios";
import React, { useEffect, useState } from "react";
import { Chart } from "react-google-charts";
import { useNavigate } from "react-router-dom";
import "./style.css"

interface IChartSever {
  Baixo?: number;
  Médio?: number;
  Alto?: number;
  Crítico: number;
}

export function ChartSever() {

  const navigate = useNavigate();

  const [severityData, setSeverityData] = useState<IChartSever>({
    Baixo: 0,
    Médio: 0,
    Alto: 0,
    Crítico: 0,
  });

  useEffect(() => {
    
    const token = localStorage.getItem("token");
    if(!token){
      navigate("/login")
      return;
    }
    axios
      .get(`http://201.49.62.134:8080/api/dashboard/charts/severity`, {
        headers: {
          Authorization: "token " + token,
        },
      })
      .then((response) => {
        setSeverityData(response.data);
      })
      .catch((e) => {
        e = "Não foi possível encontrar seus dados no momento";
        console.log(e);        
      });
  }, []);

  const data = [
    [
      "elemento",
      "Qtd. Vunerabilidades",
      { role: "style" },
      {
        sourceColumn: 0,
        role: "annotation",
        type: "string",
        calc: "stringify",
      },
    ],
    ["Baixo", severityData.Baixo, "green", null],
    ["Médio", severityData.Médio, "gold", null],
    ["Alto", severityData.Alto, "orange", null],
    ["Crítico", severityData.Crítico, "color: red", null],
  ];

  const options = {
    title: "Níveis de Severidade por vulnerabilidade",
    width: 1200,
    height: 400,
    bar: { groupWidth: "85%" },
    legend: { position: "none" },
  };

  return (
    <Flex className="chartSever">
      <Chart
        chartType="BarChart"
        width="100%"
        height="400px"
        data={data}
        options={options}
      />
    </Flex>
  );
}
