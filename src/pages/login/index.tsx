import React, { useState } from "react";
import axios from "axios";
import {
  FormControl,
  Flex,
  Input,
  Button,
  Image,
  InputGroup,
  InputLeftElement,
  Stack,
  Text,
} from "@chakra-ui/react";
import { EmailIcon, LockIcon } from "@chakra-ui/icons";
import Logo from "../../assets/logoMor.png";
import "./style.css";
import { useNavigate } from "react-router-dom";

function LoginPage() {

  const navigate = useNavigate();

  const [name, setName] = useState("");
  const [password, setPassword] = useState("");
  const [erro, setErro] = useState("");

  function onChange(e: any, setValue: any) {
    setValue(e.target.value);
  }

  function onSubmit(e: any) {
    e.preventDefault();
    if (!name || !password) {
      setErro("um dos campos nÃ£o foi preenchido corretamente.");
      return;
    }
    const data = {
      username: name,
      password: password,
    };

    axios
      .post(`http://201.49.62.134:8080/api-token-auth/`, data)
      .then((response) => {
        localStorage.setItem("token", response.data.token);
        //console.log(response.data);
        setErro("");
        navigate("/dashboard")
      })
      .catch(() => {
        setErro("preencha todos os campos corretamente");
      });
  }

  return (
    <Flex className="container">
      <Image
        className="imgLogo"
        src={Logo}
        alt=" Logo da minha futura empresa"
      />
      <FormControl id="formLogin" width="25%">
        <Stack spacing={4}>
          <Text>{erro}</Text>
          <InputGroup>
            <InputLeftElement children={<EmailIcon color="gray.300" />} />
            <Input
              type="text"
              id="userName"
              placeholder="username"
              onChange={(e) => onChange(e, setName)}
            />
          </InputGroup>
          <InputGroup>
            <InputLeftElement children={<LockIcon color="gray.300" />} />
            <Input
              type="password"
              id="userPassword"
              placeholder="senha"
              onChange={(e) => onChange(e, setPassword)}
            />
          </InputGroup>
        </Stack>
        <Flex className="btnArea">
          <Button id="bntLogin" onClick={onSubmit}>
            Login
          </Button>
        </Flex>
      </FormControl>
    </Flex>
  );
}

export default LoginPage;
